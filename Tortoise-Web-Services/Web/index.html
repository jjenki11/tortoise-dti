<!DOCTYPE html>
<html>
<head>
  <title>NIH Pediatric Neuroimaging Diffusion Tensor MRI Center - Home</title>
    <meta charset="UTF-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">	    
    <link rel="stylesheet" type="text/css" media="screen" href="css/droppable_layout.css" />
    <link rel="stylesheet" type="text/css" media="screen" href="css/droppable_widget.js.css" />
    <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
    <link href="js/vendor/jquery-ui-1.9.2/themes/base/minified/jquery-ui.min.css" rel="stylesheet" type="text/css">
    <link href="css/examples.css" rel="stylesheet" type="text/css">
    <link href="css/themes/jquery-ui-1.10.3.custom.css" rel="stylesheet" type="text/css">
    <script src="js/vendor/jquery-1.11.3.min.js"></script>
    <script src="js/vendor/jquery-ui-1.11.4.custom/jquery-ui.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script src="js/vendor/modernizr.custom.23937.js"></script>
    <script src="js/vendor/jquery-ui-1.11.4.custom/jquery-ui.js"></script>
    <script src="js/vendor/jquery-1.11.3.min.js"></script>
    <script src="js/SiteAPI.js"></script>
    <script src="js/TortoiseSceneGraph.js"></script>
    <script type="text/javascript" src="js/vendor/xtk.js"></script>
    <link href="css/plumber.css" rel="stylesheet">
    <script type="text/javascript" src="js/vendor/jquery-latest.js"></script>
    <script type="text/javascript" src="js/vendor/jquery-ui-latest.js"></script>
    <script type="text/javascript" src="js/vendor/jquery.layout-latest.js"></script>
    <script src="js/vendor/jquery.jsPlumb-1.4.1-all.js"></script>
    <script language="javascript" type="text/javascript" src="http://localhost:8444/socket.io/socket.io.js"></script>
    <script language="javascript" type="text/javascript" src="js/nodeconnection.js"></script>
    <script language="javascript" type="text/javascript" src="js/userHistory.js"></script>	
    <script src="js/vendor/modernizr.custom.23937.js"></script>
    <script language="javascript" type="text/javascript" src="js/vendor/jquery-dialogextend-master/build/jquery.dialogextend.js"></script>
    <script language="javascript" type="text/javascript" src="js/userProfile.js"></script>
    <script language="javascript" type="text/javascript" src="js/signInDialog.js"></script>
    <script type="text/javascript" src="js/vendor/jquery.layout-latest.js"></script>
    <script language="javascript" type="text/javascript" src="js/vendor/flot/jquery.flot.js"></script>
    <script language="javascript" type="text/javascript" src="js/vendor/flot/jquery.flot.time.js"></script>
    <script language="javascript" type="text/javascript" src="js/vendor/flot/jquery.flot.selection.js"></script>
    <script language="javascript" type="text/javascript" src="js/vendor/flot/jquery.flot.symbol.js"></script>	
    <script language="javascript" type="text/javascript" src="js/mathPack.js"></script>	
    <script language="javascript" type="text/javascript" src="js/MathPack2.js"></script>	
    <script language="javascript" type="text/javascript" src="js/imageTools.js"></script>	
    <script language="javascript" type="text/javascript" src="js/pluginHandler.js"></script>	
    <script language="javascript" type="text/javascript" src="js/HashTable.js"></script>
    <script language="javascript" type="text/javascript" src="js/SensoryManager.js"></script>    
    <script language="javascript" type="text/javascript" src="http://localhost:8444/socket.io/socket.io.js"></script>
    <script language="javascript" type="text/javascript" src="js/nodeconnection.js"></script>	
    <script language="javascript" type="text/javascript" src="js/userHistory.js"></script>
    <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
    <script src="http://code.jquery.com/jquery-latest.min.js" type="text/javascript"></script>

<!-- 3 D WINDOW STUFF -->
    <script language="javascript" type="text/javascript" src="js/vendor/pre3djs/pre3d.js"></script>
    <script language="javascript" type="text/javascript" src="js/vendor/pre3djs/pre3d_path_utils.js"></script>
    <script language="javascript" type="text/javascript" src="js/vendor/pre3djs/pre3d_shape_utils.js"></script>
    <script language="javascript" type="text/javascript" src="js/vendor/pre3djs/demos/colorscube.js"></script>
    <script language="javascript" type="text/javascript" src="js/vendor/pre3djs/demos/demo_utils.js"></script>	            

    <script type="text/javascript">
    
jQuery.noConflict();        
    
  var outerLayout;
  function hideCon(){
      $('.plumber').each(function(index){
            jsPlumb.hide(this.id, true);
        });
  };
  function showCon(){
      $('.plumber').each(function(index){
          jsPlumb.show(this.id, true);
          console.log(this.id);
      });
  };
  function changeLayout(){
      jsPlumb.animate($("#sink"), {"left": 900, "top": 650},    {duration: "fast"});
      jsPlumb.animate($("#target"), {"left": 650, "top": 625},    {duration: "slow"});
      jsPlumb.animate($("#source"), {"left": 450, "top": 700},    {duration: "fast"});
      jsPlumb.repaint('plumber');    
  };

//	Extends dialog object to control props
	var extendDialog = function(dialog) {
    dialog.dialogExtend({
        "maximizable" : true,
        "minimizable" : true,
        "collapsable" : true,
        "closable" : true,
        "dblclick" : "maximize"
    });
    return dialog;
  };
    
  //	To show a dialog
  var showDialog = function(theDialog, methodName, size, abctitle){
      var method = methodName || 'open';
      var ttl = abctitle || 'Image Dialog';
     // console.log('SIZE OF IMAGE: ',size.w, size.h);
      extendDialog($( "#dialog" ).dialog({
          		closeOnEscape:false,
          		title: 'Image Dialog',
          		position: {
             			my: "left top",
             			at: "left top",
             			of: $("#centerContent")//.parent(".ui-dialog")
         			},
         			width:  (size!=null) ? size.w : "auto",
         			height: (size!=null) ? size.h : "auto"
      		}));
      theDialog.dialog(method);        
  };   
    
  function startRead1(evt) {
      var file = document.getElementById("file1_dom").files[0];
      if (file) {
          //  getAsText(file);
          //uPro.
          alert("Name: " + file.name + "\n" + "Last Modified Date :" + file.lastModifiedDate);
          
      }
  };


$(document).ready(
  function(){

    var api = new SiteAPI();                     
    var omg = api.init();   
    var tools = new imageTools();
	  var plugins = new pluginHandler();			
	  var math = new mathPack();
		
		// Make all of our draggable items
		
		plugins.createDraggableItems([
      "#dragPlot", "#dragImage", "#dragEmotiv", "#drag3d",
		]);
		
		
		plugins.makeVariableEditor();
		plugins.makeOutputTerminal();
		plugins.makeInputWindow();
		
		
		// Make all of our droppable items
		
		plugins.createDroppable("#dropManipulate", "#dragInvert, #dragGrayscale, #dragBinary, #plotHistogram", function(event, ui) {
			if ($(ui.draggable).attr('id') === "dragInvert") {
  				tools.invert('imagery');
			}
			if ($(ui.draggable).attr('id') === "dragGrayscale") {
  				tools.gray('imagery');
			}
			if ($(ui.draggable).attr('id') === "dragBinary") {
  				tools.binary('imagery',127); //u can change the threshold from 127, this is halfway thru the range - [0, 255]
			}
			if ($(ui.draggable).attr('id') === "plotHistogram") {    
				var txt = "<div id=\"content\"><div class=\"demo-container\"><div id=\"placeholder\" class=\"demo-placeholder\"></div></div></div>";	
				$("#centerContent").html(txt);
				var d1 = tools.hist('imagery', 'vertical');
				var d2 = tools.hist('imagery', 'horizontal');
  			$.plot("#placeholder", [ d1, d2 ] ); //will plot both horizontal and vertical histogram
			}
		});

		plugins.createDroppable("#dropCenter", "#dragPlot, #dragEmotiv", function (event, ui) {  
		  if ($(ui.draggable).attr('id') === "dragPlot") 
  		{
  			$("#centerContent").html("<div id=\"content\"><div class=\"demo-container\"><div id=\"placeholder\" class=\"demo-placeholder\"></div></div></div>");
			  $.plot("#placeholder", [ d1 ]);
			}
			if ($(ui.draggable).attr('id') === "dragEmotiv") 
			{
			   startEmotiv();
  				console.log("emotiv connected, starting data");
			}		 		
		});


		/*Action (drop) done when you drag console icon from north pane into west pane gray area*/		
		
		plugins.createDroppable("#dropWest", "#dragConsole", function() {
		  plugins.setContent("#westContent", "#console");
		});

		/*Action (drop) done when you drag variable explorer icon from north pane into east pane gray area*/		
		
		plugins.createDroppable("#dropEast", "#dragVarExpl, #dragKeystroke", function (event, ui) {				
  		if ($(ui.draggable).attr('id') === "dragVarExpl") 
  		{
  				plugins.setContent("#eastContent", "#vars");
			}
			if ($(ui.draggable).attr('id') === "dragKeystroke") 
			{
  				plugins.setContent("#eastContent", "#pass");
			}		  
		});
		
		/*Action (drop) done when you drag output icon from north pane into south pane gray area*/
		
		plugins.createDroppable("#dropSouth", "#dragOutput", function () {		
		  plugins.setContent("#southContent", "#out");		
		  changeLayout();					
		});

		/*Action (drop) done when you drag image icon from north pane into north pane last button on the right*/
		
		plugins.createDroppable("#dropDialog", "#dragImage, #drag3d", function (event, ui) {     
		
		  if($(ui.draggable).attr('id') === "drag3d")
		  {
	    	tools.load3DCanvas();  	
    	  //tools.setImage(document.getElementById('3Dwin'), "images/scream.jpg");    			
    	  tools.set3DWindow(document.getElementById('ThreeDWin'));
    	  plugins.appendToHandle(
    		  "#dialog", 
    		  ["#ThreeDWin"]
    	  );		
      	showDialog($("#dialog"), 'open');
		  }
		  if($(ui.draggable).attr('id') === "dragImage")
		  {
		    tools.loadCanvas('imagery');  	
      	tools.setImage(document.getElementById('imagery'), "img/scream.jpg");    			
      	plugins.appendToHandle(
      		"#dialog", 
      		["#dragBinary", "#dragInvert", "#dragGrayscale", "#plotHistogram", "#imagery"]
      	);		
      	showDialog($("#dialog"), 'open');
    	}
		});			
		
		// This will set the content areas to the output and console resp. and show them in page
		plugins.setContent("#southContent", "#out");
		plugins.setContent("#westContent", "#console");
		
		// This will hide an array of handles
    var theHideList = ["#file1_dom", "#file2_dom", "#file3_dom", "#file4_dom", /*"#imagery", "#vars", "#dragBinary", "#dragInvert", "#dragGrayscale", "#plotHistogram", "#pass"*/];
		plugins.hideList(theHideList);  


      console.log("YOYOYO");       
      
      
      
                      
      $("#plumber").hide();      
	    $("#prog_bar").hide();
	    $("#dropCenter").hide();
	    
	    outerLayout = $("body").layout({
		    east__initClosed: true,
		      south__initClosed: true,
	        west__initClosed: true,
        north__initClosed: true
		  });
	    
                               
	/*	This is the data that gets plotted by default...  */	
		var d1 = [];
		for (var i = 0; i < 14; i += 0.5) 
		{
			d1.push([i, Math.sin(i)]);
		}
		var d2 = [[0, 3], [4, 8], [8, 5], [9, 13]];
		var d3 = [[0, 12], [7, 12], null, [7, 2.5], [12, 2.5]];		// A null signifies separate line segments
		

		var sock = new nodeConnection();		
		sock.init(plugins);

		sock.attachHandler('emotiv_connected', function(data){
		  console.log('data: ',data);  
		  startEmotiv(true);
		});
		sock.send('emotiv_sup', {b: 'hasDongle'});

		sock.send('plumbjs', {txt: "YEA I WANNA PLUMB"});
   setTimeout(function(){
      document.title = omg;
      // MAYBE NOT YET
      $("#col1").append(api.setupWizard("#plumber"));      
      $("#col2").append(api.fullViewer());                    
      $("#col3").append(api.embeddedViewer());
    }, 100);
                 
  });
    
    
  /* MAKE READY THE DRAG & DROP STATE MACHINE */
    
  jsPlumb.ready(function() {    
    var a = $("#source");
    var b = $("#target");          
    var c = $("#sink");
    
    var endpointOptions = { 
        isSource:true, 
        isTarget:true,
        isContentEditable:true,
        endpoint: [ "Rectangle", {radius:10} ],
        style:{ fillStyle:'blue' },
        maxConnections:-1,
        connector : "Straight",
        connectorStyle: { lineWidth:7, strokeStyle:'blue' },
        scope:"blueline",
        dropOptions:{ 
              drop:function(e, ui) 
              { 
                alert('drop!'); 
                console.log(e);
                console.log(ui);
              } 
          }  
    };
   
   
   jsPlumb.addEndpoint("source", {uuid: "srcPt" }, endpointOptions);
   jsPlumb.addEndpoint("target", {uuid: "tgtPt" }, endpointOptions);
   jsPlumb.addEndpoint("sink", {uuid: "snkPt" }, endpointOptions);
   
   

    var stateMachineConnector = {
        connector:"StateMachine",
        paintStyle:{lineWidth:3,strokeStyle:"#056"},
        hoverPaintStyle:{strokeStyle:"#dbe300"},
        endpoint:"Rectangle",
        anchor:"Continuous",
        overlays:[ ["PlainArrow", {location:1, width:15, length:12} ]]
    };
    
    var connection = jsPlumb.connect({
      source:"source",
      target:"target",
      sink:"sink",
      overlays:[
        [ "Label", {
          events:{
            click:function(labelOverlay, originalEvent) { 
              console.log("click on label overlay for :" + labelOverlay.component); 
            }
          }
        }]//,
        /*
        [ "Arrow", {
          events:{
            dblclick:function(diamondOverlay, originalEvent) { 
              console.log("double click on diamond overlay for : ", (diamondOverlay.component)); 
            }
          }
        }] */   
      ]
    });   
    
    jsPlumb.connect({source: "source",target: "sink"});
    jsPlumb.connect({source: "source",target: "target"});
    //jsPlumb.connect({uuids:["srcPt", "tgtPt", "snkPt"]});
    /* ROUTINES FOR HANDLING INPUT ON NODES */
    connection.source.bind("mouseup", function(conn) {
        console.log("you clicked on source: ", this.id);
        console.log($("#"+this.id).text());
        $("#"+this.id).text("mr source");
    });
    
    connection.target.bind("mouseup", function(conn) {
        console.log("you clicked on target: ", this.id);
        console.log($("#"+this.id).text());
        $("#"+this.id).text("mr target");
    });  
       
    c.bind("mouseup", function(conn) {
        console.log("you clicked on sink: ", this.id);
        console.log($("#"+this.id).text());
        $("#"+this.id).text("mr sink");
        
    });    
    jsPlumb.repaint('plumber');      
    jsPlumb.draggable($(".plumber"));     
                       
  });
                          
                
</script>
	    
<script>var $j = jQuery.noConflict();</script>          

   
</head>

<body>
  <!-- MIDDLE PANE -->
  <div class="ui-layout-center">
      
	  <ul id="column1" class="column">		
		  <div id="centerContent">
        <div class="container">
          <nav class="navbar navbar-inverse">
            <div class="container-fluid">
              <div class="navbar-header">
                <a class="navbar-brand" href="#">Tortoise DTI</a>
              </div>
              <div>
                <ul class="nav navbar-nav">
                  <li class="active"><a href="#">Home</a></li>
                  <li class="dropdown">
                    <a class="dropdown-toggle" data-toggle="dropdown" href="#">Page 1
                    <span class="caret"></span></a>
                    <ul class="dropdown-menu">
                      <li><a href="#">Page 1-1</a></li>
                      <li><a href="#">Page 1-2</a></li>
                      <li><a href="#">Page 1-3</a></li> 
                    </ul>
                  </li>
                  <li><a href="#">Page 2</a></li> 
                  <li><a href="#">Page 3</a></li> 
                </ul>
                <ul class="nav navbar-nav navbar-right">
                  <li><a href="#"><span class="glyphicon glyphicon-user"></span> Sign Up</a></li>
                  <li><a href="#"><span class="glyphicon glyphicon-log-in"></span> Login</a></li>
                </ul>
              </div>
            </div>
          </nav>
          <div class="jumbotron">
            <h1>NICHD STBB DTI Config and Visualization</h1>
            <p>Set up analysis and run automated scripts then view result in many viewing modalities</p> 
          </div>
    
          <div class="row">
            <div class="col-sm-4" id="col1">
              <h3>Set up Analysis</h3>
              <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit...</p>
              <p>Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris...</p>
              
            </div>
            <div class="col-sm-4" id="col2">
              <h3>View fullscreen single DTI</h3>
              <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit...</p>
              <p>Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris...</p>
            </div>
            <div class="col-sm-4" id="col3">
              <h3>View embedded (multi) DTI</h3>        
              <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit...</p>
              <p>Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris...</p>
            </div>
          </div>
          
          <div class="row">
            <div id="dropCenter" style="margin: 0 1em; padding: 1.5em; text-align: center; border: 2px solid #666; background: #666;">
			        Drop Plot icon from north pane into here to replace center pane content
		        </div>
          </div>
    
          <div class="row">
            <div id="prog_bar" class="progress">
              <div class="progress-bar" role="progressbar" aria-valuenow="70"
              aria-valuemin="0" aria-valuemax="100" style="width:70%">
                <span class="sr-only">70% Complete</span>
              </div>
          </div>
          
          <div class="row">
            <div id="plumber" style="width: 700px;height: 500px;border: solid 1px;" class="agent-wrapper" hidden="false">
            	    <div id="plumber" style="width: 700px;height: 500px;border: solid 1px;" class="agent-wrapper">
	                  <button type="button" onclick="hideCon();">Hide connections</button>
                    <button type="button" onclick="showCon()">Show connections</button>
                    <button type="button" onclick="changeLayout()">Reset Layout</button>
                    <div id="source" class="source plumber" style="width: 100px;height: 100px;border: solid 1px;">Source</div>
                    <div id="target" class="target plumber" style="width: 100px;height: 100px;border: solid 1px;">Target</div>   
                    <div id="sink" class="sink plumber" style="width: 100px;height: 100px; border: solid 1px;">SINK</div>
                  </div>  
            </div>
          </div>
        </div>   
		  </div>
	  </div>		
  </div>



    <!-- Pane draggable content -->
    <div id="dialog"></div>
    <div id="out"></div>
    <canvas id="imagery" width="950" height="750"></canvas>
    <canvas id="ThreeDWin" width="950" height="750"></canvas>
    <!--
    <input type="file" id="file1_dom" name="files[]" multiple onchange="startRead1()"/>
    -->

    <!-- THE RIGHT PANE -->
    <div class="ui-layout-east" id=east"> 
		    <div id="dropEast" style="margin: 0 1em; padding: 1.5em; text-align: center; border: 2px solid #666; background: #666;">
			    Drop Variable Explorer icon from north pane into here to replace east pane content
		    </div>
			    <div id="eastContent"></div>
    </div>

    <!-- THE LEFT PANE -->
    <div class="ui-layout-west" id="west">
	    <div id="dropWest" style="margin: 0 1em; padding: 1.5em; text-align: center; border: 2px solid #666; background: #666;">
		    Drop Console icon from north pane into here to replace west pane content
	    </div>
	    <div id="westContent"></div>
    </div>

    <!-- THE TOP PANE -->
    <div class="ui-layout-north" id="north">
	    THIS IS WHERE THE ICONS WILL GO
    <!-- for now comment out.. add in incrementally -->
	    <div id="dragPlot" style="width: 10ex; border: 2px solid #CCC; background: #009; padding: 10px;float: left;">Plot</div>
	    <div id="dragImage" style="width: 10ex; border: 2px solid #CCC; background: #009; padding: 10px;float: left;">Image</div>
	    <div id="drag3d" style="width: 10ex; border: 2px solid #CCC; background: #009; padding: 10px;float: left;">3D window</div>
	    <div id="dragConsole" style="width: 10ex; border: 2px solid #CCC; background: #009; padding: 10px;float: left;">Console</div>
	    <div id="dropDialog" style="width: 10ex; border: 2px solid #CCC; background: #009; padding: 10px;float: left;">Drop Image here</div>
	    <div id="dropManipulate" style="width: 10ex; border: 2px solid #CCC; background: #009; padding: 10px;float: left;">Drop ops</div>
	    <div id="dropCollector" style="width: 10ex; border: 2px solid #CCC; background: #009; padding: 10px;float: left;">Drop Collecter</div>
    </div>
    <!-- THE BOTTOM PANE -->
    <div class="ui-layout-south" id="south">
	    <div id="dropSouth" style="margin: 0 1em; padding: 1.5em; text-align: center; border: 2px solid #666; background: #666;">	
		    Drop Output icon from north pane into here to replace south pane content
	    </div>
	    <div id="southContent"></div>
    </div>
  </body>
</html>
